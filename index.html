
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Happy Birthday, Maryum â€” From Abdullah</title>
<style>
  :root{
    --pink:#ff4f8b;
    --rose:#ff1f5a;
    --purple:#8f49ff;
    --violet:#a93cff;
    --magenta:#ff2fb2;
    --gold:#ffca6b;
    --soft:#ffd7e6;
    --white:#fff;
    --shadow:rgba(0,0,0,0.25);
    --glass:rgba(255,255,255,0.12);
    --glass-strong:rgba(255,255,255,0.2);
  }

  *{box-sizing:border-box}
  html,body{
    margin:0;
    padding:0;
    height:100%;
    color:var(--white);
    scroll-behavior:smooth;
    background:#0d0015;
    overflow-x:hidden;
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
  }

  /* Animated romantic gradient sky */
  body::before{
    content:"";
    position:fixed; inset:0;
    background: radial-gradient(circle at 20% 10%, rgba(255,255,255,0.06), transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(255,255,255,0.05), transparent 50%),
                linear-gradient(115deg, #1f003a 0%, #3b0066 30%, #7d0078 60%, #ff2fb2 90%);
    mix-blend-mode:screen;
    pointer-events:none;
    z-index:-2;
  }
  .moving-gradient{
    position:fixed; inset:0; z-index:-3;
    background: linear-gradient(135deg, var(--rose), var(--purple), var(--magenta), var(--gold));
    background-size: 400% 400%;
    filter: saturate(1.1) brightness(0.9);
    animation: gradientFlow 24s ease-in-out infinite;
  }
  @keyframes gradientFlow{
    0%{background-position: 0% 50%}
    50%{background-position: 100% 50%}
    100%{background-position: 0% 50%}
  }

  /* Floating sparkles */
  .sparkle{ position:fixed; width:2px; height:2px; border-radius:50%; background: radial-gradient(circle, #fff, rgba(255,255,255,0.3) 60%, transparent 70%); pointer-events:none; opacity:0.7; filter: blur(0.3px); z-index:0;}
  @keyframes twinkle{
    0%,100%{ transform:scale(1); opacity:0.8}
    50%{ transform:scale(1.8); opacity:0.3}
  }

  /* Floating hearts and roses */
  .float-field{ position:fixed; inset:0; overflow:hidden; pointer-events:none; z-index:-1;}
  .heart, .rose { position:absolute; font-size:16px; opacity:0.7; filter: drop-shadow(0 2px 6px rgba(255,0,90,0.35)); animation: floatUp linear infinite; }
  .heart{ color:#ff6fa2; }
  .rose{ color:#ff5c5c; }
  @keyframes floatUp{
    0%{ transform: translateY(0) translateX(0) scale(0.8); opacity:0}
    10%{opacity:0.6}
    90%{opacity:0.8}
    100%{ transform: translateY(-120vh) translateX(var(--drift, 40px)) scale(1.4); opacity:0}
  }

  /* Petals */
  .petal{ position:fixed; width:14px; height:18px; background: radial-gradient(ellipse at 30% 30%, #ff99c2 0%, #ff5c91 55%, #ff2f6d 100%); border-radius: 60% 60% 20% 60%; transform: rotate(25deg); opacity:0.75; filter: drop-shadow(0 4px 10px rgba(255, 47, 109, 0.25)); pointer-events:none; animation: fall linear infinite; z-index:0;}
  @keyframes fall{
    0%{ transform: translateY(-20vh) translateX(0) rotate(0deg)}
    100%{ transform: translateY(120vh) translateX(var(--driftX, 140px)) rotate(360deg)}
  }

  /* Sections timeline */
  .timeline{
    scroll-snap-type: y mandatory;
    overflow-y:auto;
    height:100vh;
    position:relative;
  }
  section{
    scroll-snap-align:start;
    min-height:100vh;
    padding: 10vh 8vw;
    display:grid;
    align-items:center;
    position:relative;
  }
  .glass{
    background: linear-gradient(180deg, var(--glass), transparent 140%);
    border:1px solid rgba(255,255,255,0.14);
    border-radius:22px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3), inset 0 0 40px rgba(255,255,255,0.06);
    backdrop-filter: blur(8px) saturate(120%);
  }

  h1, h2, h3{
    margin:0 0 14px 0;
    line-height:1.14;
    text-shadow: 0 2px 16px rgba(255, 153, 204, 0.3), 0 0 24px rgba(255, 99, 165, 0.2);
    font-weight:600;
  }
  .script{
    font-family: "Brush Script MT","Lucida Handwriting","Segoe Script","Kunstler Script","Bradley Hand",cursive;
    letter-spacing:0.6px;
  }
  .huge{
    font-size: clamp(40px, 7vw, 100px);
  }
  .big{
    font-size: clamp(24px, 3.6vw, 56px);
  }
  .med{
    font-size: clamp(18px, 2.2vw, 28px);
  }
  p{ line-height:1.7; font-size:clamp(16px,1.6vw,20px); margin:10px 0 0 0; color: #ffeff8; text-shadow: 0 1px 2px rgba(0,0,0,0.25);}

  /* Animated visibility */
  .reveal{ opacity:0; transform: translateY(28px) scale(0.98); transition: all .9s ease;}
  .visible .reveal{ opacity:1; transform: translateY(0) scale(1); }
  .fade-in{ animation: fadeIn 1.4s ease both; }
  @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

  /* Typewriter effect */
  .typewriter {
    --caret: #ffe0f0;
    border-right: 2px solid var(--caret);
    white-space: nowrap; overflow: hidden;
    animation: caret 750ms steps(1) infinite;
  }
  @keyframes caret{ 50%{ border-color: transparent } }

  /* Glowing text */
  .glow{
    text-shadow: 0 0 10px rgba(255, 170, 220, 0.9),
                 0 0 30px rgba(255, 125, 190, 0.6),
                 0 0 60px rgba(255, 90, 160, 0.45);
  }

  /* Floating buttons and nav */
  .music-toggle{
    position: fixed; right: 16px; bottom: 16px; z-index: 50;
    width:64px; height:64px; cursor:pointer;
    filter: drop-shadow(0 8px 18px rgba(255, 52, 132, 0.45));
  }
  .music-toggle .btn{
    position:relative; width:100%; height:100%;
    border-radius: 18px;
    background: radial-gradient(circle at 30% 20%, #ff94c8, #ff3387 70%);
    display:grid; place-items:center;
    box-shadow: inset 0 0 24px rgba(255,255,255,0.3), 0 10px 26px rgba(255, 40, 110, 0.6);
    transition: transform .2s ease, filter .3s ease, box-shadow .3s ease;
  }
  .music-toggle .btn:active{ transform: scale(0.95); }
  .music-toggle .icon{
    font-size: 28px; text-shadow: 0 0 12px rgba(255,255,255,0.6);
    transform-origin:center;
  }
  .pulse{ animation: pulse 1.6s ease-in-out infinite; }
  @keyframes pulse{ 0%,100%{ transform: scale(1)} 50%{ transform: scale(1.08)} }

  .nav-dots{
    position: fixed; left:16px; top:50%; transform: translateY(-50%);
    display:flex; flex-direction:column; gap:12px; z-index:30;
  }
  .dot{
    width:12px; height:12px; border-radius:50%; background: rgba(255,255,255,0.5);
    border:1px solid rgba(255,255,255,0.7); cursor:pointer; transition: all .3s ease;
    box-shadow: 0 0 8px rgba(255,255,255,0.3);
  }
  .dot.active{ background: var(--gold); box-shadow: 0 0 14px var(--gold); transform: scale(1.2); }

  /* Love notes modal */
  .modal{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background: radial-gradient(circle at center, rgba(0,0,0,0.55), rgba(0,0,0,0.7));
    z-index:100;
  }
  .modal.show{ display:flex; }
  .note-card{
    position:relative; width:min(680px, 90vw); padding:26px 22px; color:#3a0030;
    background: linear-gradient(180deg, #fff3f8, #ffe4f3);
    border-radius:20px; border:1px solid #ffd0ea;
    box-shadow: 0 30px 80px rgba(255, 60, 140, 0.4);
    overflow:hidden;
  }
  .note-card:before{
    content:""; position:absolute; inset:-20% -20% auto auto; width:180px; height:180px;
    background: radial-gradient(circle at 30% 30%, rgba(255,217,236,0.9), rgba(255, 140, 190,0.6), transparent 70%);
    filter: blur(6px); transform: rotate(25deg);
  }
  .note-card h3{ margin:0 0 8px 0; font-size:26px; color:#a60069; }
  .note-card p{ color:#4b003c; text-shadow:none; }
  .note-close{
    position:absolute; right:8px; top:8px; background:#fff; border:none; border-radius:10px; padding:8px 12px;
    box-shadow: 0 6px 18px rgba(255,0,120,0.2); cursor:pointer; color:#a60069; font-weight:700;
  }
  .note-poem{ font-family:"Brush Script MT","Lucida Handwriting","Segoe Script",cursive; font-size:24px; color:#7a004f; }

  /* Parallax bits */
  .parallax{ position:absolute; inset:auto; pointer-events:none; opacity:0.5; }
  .p-rose{ font-size:32px; filter: drop-shadow(0 8px 20px rgba(255,0,100,0.4));}
  .p-heart{ font-size:28px; filter: drop-shadow(0 8px 20px rgba(255,50,150,0.55));}

  /* Buttons that reveal notes */
  .note-open{
    display:inline-grid; place-items:center;
    width:46px; height:46px; border-radius:50%;
    background: radial-gradient(circle at 30% 20%, #ffd1ea, #ff5aa8 70%);
    box-shadow: 0 8px 20px rgba(255, 40, 110, 0.55), inset 0 0 12px rgba(255,255,255,0.6);
    border:1px solid rgba(255,255,255,0.6);
    margin: 10px 12px 0 0; cursor:pointer;
    color:#fff; font-size:22px; text-shadow:0 0 12px rgba(255,255,255,0.6);
    transition: transform .2s ease;
  }
  .note-open:active{ transform: scale(0.95); }

  /* Scroll cue arrow */
  .scroll-cue{
    position:absolute; left:50%; bottom:24px; transform:translateX(-50%); opacity:0.9; font-size:14px; text-align:center;
    display:grid; place-items:center; gap:6px; color: #ffeaf4;
  }
  .arrow{
    width:22px; height:22px; border-right:2px solid #ffeaf4; border-bottom:2px solid #ffeaf4;
    transform: rotate(45deg); animation: bounce 1.4s ease-in-out infinite;
  }
  @keyframes bounce{ 0%,100%{ transform: translateY(0) rotate(45deg)} 50%{ transform: translateY(6px) rotate(45deg)} }

  /* Finale */
  .finale-title{
    line-height:1.08; text-align:center;
    background: linear-gradient(180deg, #fff, #ffe6f3, #ffd8ee);
    -webkit-background-clip: text; background-clip:text; color: transparent;
    text-shadow: 0 0 32px rgba(255, 140, 210, 0.6), 0 0 60px rgba(255,90,170,0.5);
  }
  .sub{
    text-align:center; font-size:clamp(16px,1.8vw,22px); opacity:0.9; margin-top:8px;
  }
  .finale-glow{
    animation: halo 4s ease-in-out infinite alternate;
  }
  @keyframes halo{
    from{ text-shadow: 0 0 22px rgba(255,150,220,0.65), 0 0 44px rgba(255,120,200,0.45) }
    to{ text-shadow: 0 0 34px rgba(255,190,230,0.9), 0 0 90px rgba(255,160,220,0.6) }
  }

  /* Surprise popup at the very end */
  .surprise{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:90;
    background: radial-gradient(circle at center, rgba(0,0,0,0.45), rgba(0,0,0,0.7));
  }
  .surprise .bubble{
    padding:24px 22px; border-radius:24px; text-align:center; width:min(760px, 92vw);
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,235,245,0.95));
    color:#7a004f; border:1px solid rgba(255,120,180,0.5);
    box-shadow: 0 40px 120px rgba(255, 30, 120, 0.45), inset 0 0 34px rgba(255,255,255,0.6);
  }
  .surprise .bubble h2{ margin:0 0 8px 0; font-size:clamp(26px,3.4vw,46px); color:#a80067 }
  .surprise .bubble p{ color:#550036; text-shadow:none; }
  .surprise.show{ display:flex; }

  /* Progress bar */
  .progress{
    position:fixed; left:0; top:0; height:3px; width:0; background: linear-gradient(90deg, #ffd1ea, #ff5aa8, #ffca6b);
    box-shadow: 0 0 12px rgba(255,50,120,0.8);
    z-index:60;
  }

  /* Accessibility: reduce motion */
  @media (prefers-reduced-motion: reduce) {
    *{ animation: none !important; transition: none !important}
    .moving-gradient{ background-size: auto; }
  }
</style>
</head>
<body>
  <div class="moving-gradient" aria-hidden="true"></div>

  <!-- Sparkles -->
  <div id="sparkles"></div>

  <!-- Floating field of hearts and roses -->
  <div class="float-field" id="floatField" aria-hidden="true"></div>

  <!-- Petals -->
  <div id="petals"></div>

  <!-- Progress bar -->
  <div class="progress" id="progress"></div>

  <!-- Navigation dots -->
  <div class="nav-dots" id="navDots" aria-label="Story navigation"></div>

  <!-- Music toggle -->
  <div class="music-toggle" title="Toggle music">
    <div class="btn pulse" id="musicBtn" aria-label="Music">
      <div class="icon" id="musicIcon">ğŸ’–</div>
    </div>
  </div>

  <!-- Fireworks canvas -->
  <canvas id="fireworks" style="position:fixed; inset:0; z-index:10; pointer-events:none;"></canvas>

  <!-- Story Timeline -->
  <main class="timeline" id="timeline" tabindex="0">
    <!-- SECTION 1: Introduction -->
    <section id="s1" class="visible">
      <div class="glass reveal" style="padding:28px; max-width:1000px; margin:auto;">
        <h1 class="huge script glow">Maryum, you are my favorite story. âœ¨</h1>
        <p class="med">From the very first hello, my world learned a new colorâ€”one that only your smile can paint. Every day since, I, Abdullah, have been falling deeper for the way you speak, the way you care, the way you make quiet moments feel like galaxies of starlight. â¤ï¸</p>
        <p>Tonight, letâ€™s walk through our little universeâ€”petal by petal, heartbeat by heartbeatâ€”until the sky bursts open with your birthday wish. ğŸŒ™ğŸ’–</p>
        <div style="margin-top:12px; display:flex; flex-wrap:wrap; align-items:center;">
          <button class="note-open" data-note="n1" title="Open a love note">ğŸ’Œ</button>
          <button class="note-open" data-note="n2" title="Open a love note">ğŸ’–</button>
          <button class="note-open" data-note="n3" title="Open a love note">ğŸŒ¹</button>
        </div>
      </div>
      <div class="scroll-cue">
        <div>Scroll</div>
        <div class="arrow"></div>
      </div>

      <!-- Parallax dÃ©cor -->
      <div class="parallax p-rose" data-speed="0.3" style="left:6vw; top:14vh">ğŸŒ¹</div>
      <div class="parallax p-heart" data-speed="0.2" style="right:8vw; top:22vh">ğŸ’˜</div>
    </section>

    <!-- SECTION 2: Deep feelings & poetry -->
    <section id="s2">
      <div class="glass reveal" style="padding:30px; max-width:980px; margin:auto;">
        <h2 class="big script glow">A poem from my heart to yours ğŸ’Œ</h2>

        <p class="typewriter" id="type1" style="--caret:#ffd6ec; max-width: 38ch;"></p>

        <div style="margin-top:18px">
          <p class="med">When I call your name, Maryum, the night listens. Even the moon blushes softly, and the stars lean closer. You are my prayer answered, my home found, my forever promised. ğŸ’âœ¨</p>
          <div style="margin-top:12px; display:flex; flex-wrap:wrap; align-items:center;">
            <button class="note-open" data-note="n4">ğŸ’</button>
            <button class="note-open" data-note="n5">ğŸŒ™</button>
          </div>
        </div>
      </div>

      <div class="parallax p-heart" data-speed="0.35" style="left:10vw; bottom:18vh">ğŸ’–</div>
      <div class="parallax p-rose" data-speed="0.25" style="right:12vw; bottom:26vh">ğŸŒ¹</div>
    </section>

    <!-- SECTION 3: Anticipation & build-up -->
    <section id="s3">
      <div class="glass reveal" style="padding:30px; max-width:940px; margin:auto;">
        <h2 class="big script glow">The moment right before the wishâ€¦ â³âœ¨</h2>
        <p class="med">Close your eyes for a heartbeat, my love. Feel my hands in yours. Hear the soft music of our future. The sky is holding its breathâ€”waiting for your smile. When youâ€™re ready, press the golden heart below and watch the heavens celebrate you. ğŸŒŸ</p>
        <div style="display:flex; align-items:center; gap:10px; margin-top:16px;">
          <button id="buildBtn" class="note-open" style="background: radial-gradient(circle at 30% 20%, #ffe7ad, #ff9d3c 70%); box-shadow: 0 10px 22px rgba(255,170,40,0.55)">ğŸ’</button>
          <span>Tap the golden heart to call the starsâ€¦</span>
        </div>

        <div style="margin-top:18px; display:flex; gap:10px; align-items:center;">
          <span class="note-open" data-note="n6">ğŸ’«</span>
          <span class="note-open" data-note="n7">ğŸ’—</span>
        </div>
      </div>

      <div class="parallax p-heart" data-speed="0.2" style="left:20vw; top:24vh">ğŸ’•</div>
      <div class="parallax p-rose" data-speed="0.35" style="right:12vw; top:16vh">ğŸŒ·</div>
    </section>

    <!-- SECTION 4: Grand Finale -->
    <section id="s4">
      <div class="reveal" style="text-align:center; margin:auto;">
        <h2 class="script big finale-glow">Ready? 3â€¦ 2â€¦ 1â€¦</h2>
        <h1 class="huge finale-title glow" id="finaleTitle" style="margin-top:10px;">
          Happy Birthday Maryum ğŸ‰â¤ï¸<br/>â€” From Abdullah â€”
        </h1>
        <p class="sub">May your year be dressed in rose-gold mornings, strawberry skies, and a thousand tiny miracles. ğŸŒ¹âœ¨</p>
        <div style="margin-top:16px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap">
          <button class="note-open" data-note="n8">ğŸ‚</button>
          <button class="note-open" data-note="n9">ğŸ’</button>
          <button class="note-open" data-note="n10">ğŸŒŸ</button>
        </div>
      </div>
      <div class="scroll-cue" style="bottom:32px">
        <div>With all my love, forever.</div>
      </div>
    </section>
  </main>

  <!-- Notes modal -->
  <div class="modal" id="noteModal" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
    <div class="note-card fade-in" id="noteCard">
      <button class="note-close" id="noteClose">Close âœ•</button>
      <h3 id="noteTitle" class="script">A letter for you</h3>
      <div id="noteBody"></div>
    </div>
  </div>

  <!-- End Surprise popup -->
  <div class="surprise" id="surprise">
    <div class="bubble">
      <h2 class="script">Happy Birthday, my dearest Maryum ğŸ‚âœ¨ğŸ’</h2>
      <p class="med">From Abdullah â€” in this tiny universe of pixels and petals, Iâ€™ve hidden a promise: to love you gently, loudly, endlessly. Thank you for being the most beautiful â€œalwaysâ€ Iâ€™ve ever known. ğŸ’–</p>
    </div>
  </div>

<script>
/* --- Utilities --- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

/* --- Sparkles --- */
(function makeSparkles(){
  const container = document.getElementById('sparkles');
  for(let i=0;i<80;i++){
    const s = document.createElement('div');
    s.className='sparkle';
    const x = Math.random()*100, y = Math.random()*100;
    s.style.left = x+'vw';
    s.style.top = y+'vh';
    s.style.animation = `twinkle ${2+Math.random()*4}s ease-in-out ${Math.random()*2}s infinite`;
    container.appendChild(s);
  }
})();

/* --- Floating hearts, roses, and petals --- */
(function floatingDecor(){
  const field = document.getElementById('floatField');
  const petals = document.getElementById('petals');

  // hearts & roses
  const icons = ['ğŸ’–','ğŸ’˜','ğŸ’—','ğŸ’','ğŸ’“','ğŸ’','ğŸŒ¹','ğŸŒ·','ğŸ’'];
  for(let i=0;i<36;i++){
    const span = document.createElement('span');
    const isRose = Math.random()>0.65;
    span.className = isRose ? 'rose' : 'heart';
    span.textContent = isRose ? 'ğŸŒ¹' : icons[Math.floor(Math.random()*6)];
    span.style.left = Math.random()*100+'vw';
    span.style.bottom = (-10 - Math.random()*25) + 'vh';
    span.style.setProperty('--drift', (Math.random()*120-60)+'px');
    span.style.animationDuration = (12+Math.random()*16)+'s';
    span.style.animationDelay = (Math.random()*8)+'s';
    field.appendChild(span);
  }

  // petals
  for(let i=0;i<28;i++){
    const p = document.createElement('div');
    p.className='petal';
    p.style.left = Math.random()*100+'vw';
    p.style.top = (-Math.random()*80)+'vh';
    p.style.opacity = 0.5+Math.random()*0.5;
    p.style.setProperty('--driftX', (Math.random()*180-90)+'px');
    p.style.animationDuration = (10+Math.random()*16)+'s';
    p.style.animationDelay = (Math.random()*6)+'s';
    petals.appendChild(p);
  }
})();

/* --- Intersection observer: reveal sections & nav dots --- */
const sections = $$('#timeline section');
const navDots = $('#navDots');
sections.forEach((sec,i)=>{
  const a = document.createElement('div');
  a.className='dot';
  a.title = `Go to Section ${i+1}`;
  a.addEventListener('click', ()=> sec.scrollIntoView({behavior:'smooth'}));
  navDots.appendChild(a);
});
const dotEls = $$('#navDots .dot');

const IO = new IntersectionObserver((entries)=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){
      entry.target.classList.add('visible');
      const idx = sections.indexOf(entry.target);
      dotEls.forEach(d=>d.classList.remove('active'));
      if(dotEls[idx]) dotEls[idx].classList.add('active');

      if(entry.target.id==='s4'){
        launchFinale();
      }
    }
  });
}, { threshold: 0.6 });
sections.forEach(s=>IO.observe(s));

/* --- Progress bar --- */
const progressEl = $('#progress');
const timeline = $('#timeline');
timeline.addEventListener('scroll', ()=>{
  const max = timeline.scrollHeight - timeline.clientHeight;
  const pct = Math.min(1, Math.max(0, timeline.scrollTop / max));
  progressEl.style.width = (pct*100) + '%';
});

/* --- Parallax layers --- */
const parallaxEls = $$('.parallax');
function parallax(){
  const scrollTop = timeline.scrollTop;
  parallaxEls.forEach(el=>{
    const speed = parseFloat(el.dataset.speed || '0.3');
    el.style.transform = `translateY(${scrollTop * speed}px)`;
  });
}
timeline.addEventListener('scroll', parallax);

/* --- Typewriter text --- */
const poemLines = [
  "Tum meri subah ka noor ho, meri shaam ki dua â€”",
  "har lamha tum se roshan, har saans tum se juda. ğŸ’—",
  "Teri hansi mein mehfil, teri aankhon mein asmaan,",
  "meri har dhadkan ke beech bas tera hi naam. ğŸŒ™âœ¨"
];
function typewriter(el, lines, speed=42, pause=700){
  let li=0, ch=0, txt='';
  function step(){
    if(li>=lines.length) return;
    const line = lines[li];
    if(ch<=line.length){
      txt = lines.slice(0,li).join('\n') + (li?'\n':'') + line.slice(0,ch);
      el.textContent = txt;
      ch++;
      setTimeout(step, speed);
    }else{
      li++; ch=0;
      setTimeout(step, pause);
    }
  }
  step();
}
typewriter($('#type1'), poemLines);

/* --- Love notes content --- */
const notes = {
  n1: {
    title: "The first spark âœ¨",
    body: `<p>Maryum, the first time I heard your laugh, I knew life had been waiting for that exact sound. It felt like doors opening, light pouring in, and a thousand roses learning how to bloom at once. ğŸŒ¹</p>`
  },
  n2: {
    title: "Home in your eyes ğŸ¡ğŸ’–",
    body: `<p>I didnâ€™t find love in a place â€” I found it in a person. I found it in <strong>you</strong>. Your eyes feel like home, your words feel like prayer, and your smile feels like sunrise. â˜€ï¸</p>`
  },
  n3: {
    title: "For my moon and my miracle ğŸŒ™",
    body: `<p class="note-poem">Teri baahon mein khamoshi bhi gana ban jaati hai,<br/>Tere saath har rasta manzil ban jaata hai.<br/>Maryum, tum ho toh zindagi, zindagi si lagti hai. ğŸ’</p>`
  },
  n4: {
    title: "A promise in petals ğŸŒº",
    body: `<p>I promise to learn the rhythm of your silences, the poetry of your thoughts, the map of your dreams â€” and to hold your heart like something soft and sacred. ğŸ’</p>`
  },
  n5: {
    title: "Night & stardust ğŸŒŒ",
    body: `<p class="note-poem">Raat ne aaj phir se sitaron ko sajaya hai,<br/>tune muskuraya, bas asmaan ne jhuk ke duaa di hai.<br/>Tum ho toh har raat Eid, har din Diwali. âœ¨</p>`
  },
  n6: {
    title: "The heartbeat before the surprise ğŸ’“",
    body: `<p>Take a deep breath, my love. Count the beats with me: 1â€¦ 2â€¦ 3â€¦ Every number is a kiss, and every kiss is a wish for you. ğŸ</p>`
  },
  n7: {
    title: "Golden thread ğŸ§µ",
    body: `<p>We are stitched together by something soft and golden. Even when the world is loud, I hear your name in the quiet between seconds. ğŸ’«</p>`
  },
  n8: {
    title: "Make a wish ğŸ‚",
    body: `<p>Blow the candles in your heart, Maryum. May kindness choose your doorstep daily, may joy sit at your table, and may I always be the one refilling your cup with love. ğŸ¥‚ğŸ’–</p>`
  },
  n9: {
    title: "Forever kind of love ğŸ’",
    body: `<p class="note-poem">Kal, aaj, kal ke baad â€” sab mein tum;<br/>har pal ke darmiyan â€” bas tum.<br/>Abdullah ka har sapna, tum se hi poora. ğŸ’–</p>`
  },
  n10: {
    title: "Starlight letter ğŸŒŸ",
    body: `<p>If the sky could write, it would spell your name in gold. Until then, Iâ€™ll write it everywhere I go, with the same soft certainty: I choose you. Always. âœ¨</p>`
  }
};

/* --- Notes modal logic --- */
const noteModal = $('#noteModal');
const noteTitle = $('#noteTitle');
const noteBody = $('#noteBody');
const noteClose = $('#noteClose');

$$('.note-open').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const id = btn.dataset.note;
    if(!id) return;
    const n = notes[id];
    if(n){
      noteTitle.textContent = n.title;
      noteBody.innerHTML = n.body;
      noteModal.classList.add('show');
    }
  });
});
noteClose.addEventListener('click', ()=> noteModal.classList.remove('show'));
noteModal.addEventListener('click', e=>{ if(e.target===noteModal) noteModal.classList.remove('show') });

/* --- Build-up button: intensify petals + add sparkles --- */
$('#buildBtn').addEventListener('click', ()=>{
  // Add a burst of petals
  const petals = $('#petals');
  for(let i=0;i<18;i++){
    const p = document.createElement('div');
    p.className='petal';
    p.style.left = (10 + Math.random()*80)+'vw';
    p.style.top = (-Math.random()*30)+'vh';
    p.style.setProperty('--driftX', (Math.random()*220-110)+'px');
    p.style.animationDuration = (8+Math.random()*10)+'s';
    petals.appendChild(p);
    setTimeout(()=> p.remove(), 16000);
  }
  // Sparkle shimmer
  $$('#sparkles .sparkle').forEach(s=>{
    s.style.animationDuration = (1.2+Math.random()*2)+'s';
  });
});

/* --- Music (WebAudio): a gentle Hindi/romantic inspired melody --- */
let AudioCTX = null, master, leadGain, padGain, delay, started=false, playing=false;
let scheduler = null, t0=0, beat=0, bpm=88;
function noteToFreq(n){
  // A4=440
  const map = {C:0,'C#':1,Db:1,D:2,'D#':3,Eb:3,E:4,F:5,'F#':6,Gb:6,G:7,'G#':8,Ab:8,A:9,'A#':10,Bb:10,B:11};
  const m = n.match(/^([A-G]#?|Bb|Db|Gb)(\d)$/);
  if(!m) return 440;
  const key=m[1], oct=parseInt(m[2],10);
  const semis = (oct-4)*12 + map[key];
  return 440 * Math.pow(2, semis/12);
}
// Create a warm lead with light vibrato
function playVoice(freq, time, dur, gainNode, type='sine', vibr=5, depth=10){
  const o = AudioCTX.createOscillator();
  const g = AudioCTX.createGain();
  const lfo = AudioCTX.createOscillator();
  const lfoG = AudioCTX.createGain();

  o.type = type;
  o.frequency.value = freq;

  lfo.frequency.value = vibr; // vibrato speed
  lfoG.gain.value = depth;    // vibrato depth in cents

  // cents to frequency modulation
  const det = o.detune;
  lfo.connect(lfoG).connect(det);

  o.connect(g).connect(gainNode);
  // ADSR
  const a=0.06, d=0.18, s=0.7, r=0.25;
  g.gain.setValueAtTime(0, time);
  g.gain.linearRampToValueAtTime(1, time+a);
  g.gain.linearRampToValueAtTime(s, time+a+d);
  g.gain.linearRampToValueAtTime(0.0001, time+dur+r);

  o.start(time);
  lfo.start(time);
  o.stop(time+dur+r+0.02);
  lfo.stop(time+dur+r+0.02);
}
// Soft pad
function playPad(freq, time, dur){
  const o1 = AudioCTX.createOscillator();
  const o2 = AudioCTX.createOscillator();
  const g = AudioCTX.createGain();
  o1.type='sine'; o2.type='triangle';
  o1.frequency.setValueAtTime(freq*0.5, time);
  o2.frequency.setValueAtTime(freq*1.0, time);
  o1.detune.value = -3; o2.detune.value = 3;
  o1.connect(g); o2.connect(g);
  g.connect(delay);
  const a=0.4, r=1.4;
  g.gain.setValueAtTime(0, time);
  g.gain.linearRampToValueAtTime(0.42, time+a);
  g.gain.linearRampToValueAtTime(0.36, time+dur);
  g.gain.linearRampToValueAtTime(0, time+dur+r);
  o1.start(time); o2.start(time);
  o1.stop(time+dur+r+0.05); o2.stop(time+dur+r+0.05);
}
function initAudio(){
  if(started) return;
  AudioCTX = new (window.AudioContext || window.webkitAudioContext)();
  master = AudioCTX.createGain();
  leadGain = AudioCTX.createGain();
  padGain = AudioCTX.createGain();
  delay = AudioCTX.createDelay();
  const feedback = AudioCTX.createGain();
  const delayFilter = AudioCTX.createBiquadFilter();
  delayFilter.type='lowpass'; delayFilter.frequency.value=2400;

  delay.delayTime.value = 0.28;
  feedback.gain.value = 0.42;

  // chain
  delay.connect(delayFilter).connect(feedback).connect(delay);
  padGain.connect(delay);
  leadGain.connect(delay);
  delay.connect(master);

  // master comp/limiter-ish
  const comp = AudioCTX.createDynamicsCompressor();
  comp.threshold.setValueAtTime(-18, AudioCTX.currentTime);
  comp.knee.setValueAtTime(20, AudioCTX.currentTime);
  master.connect(comp).connect(AudioCTX.destination);

  master.gain.value = 0.45;
  leadGain.gain.value = 0.36;
  padGain.gain.value = 0.22;

  started = true;
}
function startMusic(){
  if(playing) return;
  initAudio();
  const baseTime = AudioCTX.currentTime + 0.05;
  t0 = baseTime;
  beat = 60/bpm;

  // Romantic Hindustani-inspired motif in Yaman-ish color
  // Sequence of bars (each with note & duration in beats)
  const melody = [
    {n:'E5', d:1},{n:'G#5', d:1},{n:'F#5', d:2},
    {n:'B4', d:1},{n:'C#5', d:1},{n:'E5', d:2},
    {n:'G#5', d:1},{n:'F#5', d:1},{n:'E5', d:1},{n:'C#5', d:1},
    {n:'B4', d:4},

    {n:'E5', d:1},{n:'G#5', d:1},{n:'A5', d:2},
    {n:'F#5', d:1},{n:'E5', d:1},{n:'C#5', d:2},
    {n:'B4', d:1},{n:'C#5', d:1},{n:'E5', d:1},{n:'G#5', d:1},
    {n:'F#5', d:4},
  ];
  const pads = [
    {n:'E4', d:4},{n:'B3', d:4},{n:'C#4', d:4},{n:'A3', d:4},
  ];

  let mIdx=0, pIdx=0, bar=0;
  scheduler = setInterval(()=>{
    if(!AudioCTX) return;
    const now = AudioCTX.currentTime;
    // schedule ahead
    while(t0 < now + 0.25){
      // lead
      const m = melody[mIdx];
      const dur = m.d * beat;
      const f = noteToFreq(m.n);
      playVoice(f, t0, dur*0.96, leadGain, 'sine', 4.6, 9);
      t0 += dur;
      mIdx = (mIdx+1) % melody.length;

      // every bar, schedule a pad
      if(bar % 4 === 0){
        const pp = pads[pIdx];
        playPad(noteToFreq(pp.n), t0 - dur, pp.d*beat);
        pIdx = (pIdx+1) % pads.length;
      }
      bar++;
    }
  }, 90);
  playing = true;
  $('#musicBtn').classList.add('pulse');
  $('#musicIcon').textContent = 'ğŸ’–';
}
function stopMusic(){
  if(!playing) return;
  if(scheduler) clearInterval(scheduler);
  scheduler = null;
  if(master){
    const t = AudioCTX.currentTime;
    master.gain.cancelScheduledValues(t);
    master.gain.linearRampToValueAtTime(0, t+0.6);
    setTimeout(()=>{
      try{ AudioCTX.close(); }catch(e){}
      AudioCTX = null; started=false;
    }, 700);
  }
  playing = false;
  $('#musicBtn').classList.remove('pulse');
  $('#musicIcon').textContent = 'ğŸ’—';
}
const musicBtn = $('#musicBtn');
musicBtn.addEventListener('click', ()=>{
  if(!playing){ startMusic(); } else { stopMusic(); }
});
/* Try autoplay (may be blocked by browser; toggle works as fallback) */
window.addEventListener('load', ()=>{
  setTimeout(()=>{ try{ startMusic(); }catch(e){} }, 400);
});
document.addEventListener('touchstart', ()=>{ if(!playing){ try{ startMusic(); }catch(e){} } }, {once:true});
document.addEventListener('click', (e)=> {
  if(!playing && !e.target.closest('.note-open') && !e.target.closest('#noteModal')) {
    try{ startMusic(); }catch(e){}
  }
}, {once:true});

/* --- Fireworks --- */
const fw = document.getElementById('fireworks');
const ctx = fw.getContext('2d');
let W=fw.width=window.innerWidth, H=fw.height=window.innerHeight, particles=[];
window.addEventListener('resize', ()=>{ W=fw.width=window.innerWidth; H=fw.height=window.innerHeight; });

function firework(x, y, color){
  const count = 80 + Math.floor(Math.random()*40);
  for(let i=0;i<count;i++){
    const angle = Math.random()*Math.PI*2;
    const speed = 1.5 + Math.random()*3.2;
    particles.push({
      x, y,
      vx: Math.cos(angle)*speed,
      vy: Math.sin(angle)*speed,
      life: 1,
      decay: 0.008 + Math.random()*0.015,
      color
    });
  }
}
function renderFW(){
  ctx.globalCompositeOperation='destination-out';
  ctx.fillStyle='rgba(0,0,0,0.25)';
  ctx.fillRect(0,0,W,H);
  ctx.globalCompositeOperation='lighter';

  particles.forEach(p=>{
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.015; p.life-=p.decay;
  });
  particles = particles.filter(p=>p.life>0);

  particles.forEach(p=>{
    const g = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,3);
    g.addColorStop(0, `rgba(255,255,255,${p.life})`);
    g.addColorStop(1, `rgba(${p.color.r},${p.color.g},${p.color.b},${p.life*0.9})`);
    ctx.fillStyle=g;
    ctx.beginPath(); ctx.arc(p.x,p.y, 2.2, 0, Math.PI*2); ctx.fill();
  });

  requestAnimationFrame(renderFW);
}
renderFW();

function randomFirework(){
  const x = Math.random()*W*0.8 + 0.1*W;
  const y = Math.random()*H*0.5 + 0.05*H;
  const palette = [
    {r:255,g:120,b:180}, {r:255,g:80,b:140},
    {r:255,g:200,b:120}, {r:180,g:110,b:255}
  ];
  firework(x,y, palette[Math.floor(Math.random()*palette.length)]);
}

/* --- Finale sequence --- */
let finaleLaunched=false;
function launchFinale(){
  if(finaleLaunched) return;
  finaleLaunched = true;

  // Crescendo the music if playing
  try{
    if(started && master){
      const t = AudioCTX.currentTime;
      master.gain.cancelScheduledValues(t);
      master.gain.linearRampToValueAtTime(0.65, t+1.2);
    }
  }catch(e){}

  // Repeated fireworks
  let bursts=0;
  const timer = setInterval(()=>{
    randomFirework(); randomFirework();
    bursts++;
    if(bursts>16) clearInterval(timer);
  }, 450);

  // Surprise popup after a moment
  setTimeout(()=> $('#surprise').classList.add('show'), 2400);
  // Remove after a while
  setTimeout(()=> $('#surprise').classList.remove('show'), 8000);
}

/* --- Keyboard navigation for accessibility --- */
document.addEventListener('keydown', e=>{
  if(e.key==='ArrowDown' || e.key==='PageDown'){ e.preventDefault(); nextSection(); }
  if(e.key==='ArrowUp' || e.key==='PageUp'){ e.preventDefault(); prevSection(); }
});
function nextSection(){
  const i = sections.findIndex(s=> s.getBoundingClientRect().top >= -1 && s.getBoundingClientRect().top < window.innerHeight/2);
  const idx = (i<0?0:i);
  if(sections[idx+1]) sections[idx+1].scrollIntoView({behavior:'smooth'});
}
function prevSection(){
  const i = sections.findIndex(s=> s.getBoundingClientRect().top >= -1 && s.getBoundingClientRect().top < window.innerHeight/2);
  const idx = (i<=0?0:i);
  if(sections[idx-1]) sections[idx-1].scrollIntoView({behavior:'smooth'});
}
</script>
</body>
</html>


